---
title: "A corpus-based analysis of ongoing change in the adjective amplifier systems of Hong Kong, Philippine, and Indian English - Part 3"
author: Martin Schweinberger
date: "`r format(Sys.time(), '%Y-%m-%d')`"
output: word_document
---

# Introduction{-}

This document shows an analysis of adjective amplification in Hong Kong, Indian , and Philippine English based on the respective components of the International Corpus of English (ICE). 

```{r, echo=FALSE}
knitr::opts_chunk$set(error = TRUE)
```

## Preparation{-}

In a first step, the session is prepared by clearing the work space, setting options, activating packages and functions, as well as loading relevant functions.

```{r amphkpie_02_01, echo=T, eval = T, message=FALSE, warning=FALSE}
# clean current workspace
rm(list=ls(all=T))                                      
# load packages
library(tidyverse)
library(dplyr)
library(tidyr)
library(ggplot2)
# set options
options(stringsAsFactors = F)                           
options(scipen = 999) 
options(max.print=10000)
# define image directory
imageDirectory <- "images"   
```

## Load data{-}

```{r amphkpie_02_03, echo=T, eval = T, message=FALSE, warning=FALSE}
ice <- read.delim("D:\\Uni\\Projekte\\02-Intensification\\AmpHKPIE\\data\\editdata//iceamp_04_clean.txt", sep = "\t", header = T)
# inspect
head(ice)
```

## Clean data

Factorize predictors and scale frequency

```{r amphkpie_02_05, echo=T, eval = T, message=FALSE, warning=FALSE}
ice <- ice %>%
  select(-Id, -Correction, -SpeechUnit, -SpeechUnitCount, -PreContext, -Token, -L1, 
         -PostContext, -PreContextLong, -Amplified, -Nationality, -OtherLanguages, -Birthplace) %>%
  dplyr::mutate(Emotionality = ifelse(Emotionality == "PositiveEmotional", "Positive",
                               ifelse(Emotionality == "NonEmotional", "Neutral", "Negative")),
                Emotionality = factor(Emotionality, levels = c("Negative", "Neutral", "Positive")),
                Frequency = as.vector(scale(Frequency)),
                Gender = factor(Gender),
                EducationLevel = factor(EducationLevel),
                Priming = factor(Priming),
                Emotionality = factor(Emotionality),
                Function = factor(Function),
                Ethnicity = factor(Ethnicity),
                SemanticCategory = factor(SemanticCategory),
                Speaker = paste0(File, "$", Speaker)) %>%
  select(-File, -WordCount)
str(ice)
```

Determine adjective frequency

```{r amphkpie_02_07, echo=T, eval = T, message=FALSE, warning=FALSE}
fadj <- names(table(ice$Adjective))[which(table(ice$Adjective) > 15)]
fadj
```

Determine variant frequency

```{r amphkpie_02_09, echo=T, eval = T, message=FALSE, warning=FALSE}
famp <- names(table(ice$Variant))[which(table(ice$Variant) > 50)]
famp
```
Collapse infrequent adjectives and amplifiers

```{r amphkpie_02_11, echo=T, eval = T, message=FALSE, warning=FALSE}
ice <- ice %>%
  mutate(Adjective = ifelse(Adjective %in% fadj, Adjective, "other"),
         Variant = ifelse(Variant %in% famp, Variant, "other"),
         Adjective = factor(Adjective),
         Variant = factor(Variant)) %>%
  group_by(Corpus) %>%
  mutate(Frequency = scale(Frequency)[,1])
str(ice)
```

## Data inspection{-}

Visualize Variant by Corpus and Age

```{r amphkpie_02_13, echo=T, eval = T, message=FALSE, warning=FALSE}
ice %>%
  mutate(Age = ifelse(Age == "16-25"|Age == "17-25"|Age == "18-25", 3, 
               ifelse(Age == "26-40"|Age == "26-41", 2, 
               ifelse(Age == "41+"|Age == "42+", 1, Age))),
         Corpus = ifelse(Corpus == "ICE-HK", "ICE Hong Kong",
                  ifelse(Corpus == "ICE-IND", "ICE India", "ICE Philippines"))) %>%
  group_by(Corpus, Age, Variant) %>%
  summarise(Frequency = n()) %>%
  group_by(Corpus, Age) %>%
  mutate(AllSlots = sum(Frequency),
         Percent = round(Frequency/AllSlots*100, 1)) %>%
  select(-Frequency, -AllSlots) %>%
  ggplot(aes(x = Age, y = Percent, 
             group = Variant, color = Variant, linetype = Variant)) +
  facet_grid(cols = vars(Corpus)) +
  geom_line() + 
  coord_cartesian(ylim = c(0, 100)) +
  theme_set(theme_bw(base_size = 12)) +
  theme(legend.position="top", 
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(), 
        axis.text.x = element_text(size=10)) +
  scale_color_manual(breaks = c("other", "really", "so", "very"),
                     values = c("gray80", "gray60", "gray40", "gray20")) +
  scale_linetype_manual(breaks = c("other", "really", "so", "very"),
                        values = c(4, 3, 2, 1)) + 
  scale_x_discrete(breaks = 1:3, 
                   labels = c("41+", "26-41", "16-25")) +
  ggsave(file = 
           "D:\\Uni\\Projekte\\02-Intensification\\AmpHKPIE\\images/VariantAgeCorpus.png",
         height = 4,  width = 6, dpi = 320)
  
```

Visualize Variant by Corpus and Age and Function

```{r amphkpie_02_15, echo=T, eval = T, message=FALSE, warning=FALSE}
ice %>%
  mutate(Age = ifelse(Age == "16-25"|Age == "17-25"|Age == "18-25", 3, 
               ifelse(Age == "26-40"|Age == "26-41", 2, 
               ifelse(Age == "41+"|Age == "42+", 1, Age))),
         Corpus = ifelse(Corpus == "ICE-HK", "ICE Hong Kong",
                  ifelse(Corpus == "ICE-IND", "ICE India", "ICE Philippines"))) %>%
  group_by(Corpus, Age, Variant, Function) %>%
  summarise(Frequency = n()) %>%
  group_by(Corpus, Age, Function) %>%
  mutate(AllSlots = sum(Frequency),
         Percent = round(Frequency/AllSlots*100, 1)) %>%
  select(-Frequency, -AllSlots) %>%
  ggplot(aes(x = Age, y = Percent, 
             group = Variant, color = Variant, linetype = Variant)) +
  facet_grid(cols = vars(Corpus), rows=vars(Function)) +
  geom_line() + 
  coord_cartesian(ylim = c(0, 100)) +
  theme_set(theme_bw(base_size = 12)) +
  theme(legend.position="top", 
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(), 
        axis.text.x = element_text(size=10)) +
  scale_color_manual(breaks = c("other", "really", "so", "very"),
                     values = c("gray80", "gray60", "gray40", "gray20")) +
  scale_linetype_manual(breaks = c("other", "really", "so", "very"),
                        values = c(4, 3, 2, 1)) +  
  scale_x_discrete(breaks = 1:3, 
                   labels = c("41+", "26-41", "16-25")) +
  ggsave(file = 
           "D:\\Uni\\Projekte\\02-Intensification\\AmpHKPIE\\images/VariantAgeCorpusFunction.png",
         height = 4,  width = 6, dpi = 320)
  
```

# Analysis of ICE-PHI{-}

## VERY{-}

```{r amphkpie_02_17, echo=T, eval = T, message=FALSE, warning=FALSE}
phi_very <- ice %>%
  ungroup() %>%
  filter(Corpus == "ICE-PHI") %>%
  mutate(Age = factor(Age),
         Date = ifelse(Date == "1991"|Date == "1992", "Before1993", "After1998"),
         Date = factor(Date, levels = c("Before1993", "After1998")),
         Corpus = factor(Corpus),
         Speaker = factor(Speaker),
         Variant = ifelse(Variant == "very", "very", "other"),
         Variant = factor(Variant)) %>%
  droplevels()
# inspect
head(phi_very)
```

Find variables that cannot be tested

```{r amphkpie_02_19, echo=T, eval = T, message=FALSE, warning=FALSE}
l <- sapply(phi_very, function(x) is.factor(x))
m <- phi_very[, l]
ifelse(n <- sapply(m, function(x) length(levels(x))) == 1, "DROP", "NODROP")
```

Remove variables and NA

```{r amphkpie_02_21, echo=T, eval = T, message=FALSE, warning=FALSE}
nrow(phi_very)
phi_very <- phi_very %>%
  select(-Corpus, -EducationLevel, -Ethnicity) %>%
  na.omit()
nrow(phi_very)
```

## Regression analysis{-}

Prepare data

```{r amphkpie_02_23, echo=T, eval = T, message=FALSE, warning=FALSE}
library(rms)
library(lme4)
# set options
options(contrasts  =c("contr.treatment", "contr.poly"))
phi_very.dist <- datadist(phi_very)
options(datadist = "phi_very.dist")
# generate models
m0.glmer = glmer(Variant ~ 1 + (1|Adjective) + (1|Speaker), 
                 data = phi_very, family = "binomial",
                 control=glmerControl(optimizer="bobyqa"))
# extract aics
aic.m0.glmer <- AIC(logLik(m0.glmer))
aic.m0.glmer
```

### Model fitting{-}

Age

```{r amphkpie_02_25, echo=T, eval = T, message=FALSE, warning=FALSE}
m1.glmer <- update(m0.glmer, .~.+Age)
anova(m1.glmer, m0.glmer, test = "Chi")       
library(car)
Anova(m1.glmer, type = "III", test = "Chi")   
```

Gender

```{r amphkpie_02_27, echo=T, eval = T, message=FALSE, warning=FALSE}
m2.glmer <- update(m1.glmer, .~.+ Gender)
car::vif(m2.glmer)
anova(m2.glmer, m1.glmer, test = "Chi")       
Anova(m2.glmer, type = "III", test = "Chi")   
```

Function

```{r amphkpie_02_29, echo=T, eval = T, message=FALSE, warning=FALSE}
m3.glmer <- update(m2.glmer, .~.+Function)
car::vif(m3.glmer)
anova(m3.glmer, m2.glmer, test = "Chi")       
Anova(m3.glmer, type = "III", test = "Chi")   
```

Date

```{r amphkpie_02_31, echo=T, eval = T, message=FALSE, warning=FALSE}
m4.glmer <- update(m3.glmer, .~.+ Date)
car::vif(m4.glmer)
anova(m4.glmer, m3.glmer, test = "Chi")
```

Frequency

```{r amphkpie_02_33, echo=T, eval = T, message=FALSE, warning=FALSE}
m5.glmer <- update(m3.glmer, .~.+ Frequency)
car::vif(m5.glmer)
anova(m5.glmer, m3.glmer, test = "Chi")   
```

Priming

```{r amphkpie_02_35, echo=T, eval = T, message=FALSE, warning=FALSE}
m6.glmer <- update(m3.glmer, .~.+ Priming)
car::vif(m6.glmer)
anova(m6.glmer, m3.glmer, test = "Chi")  
```

Gradability

```{r amphkpie_02_37, echo=T, eval = T, message=FALSE, warning=FALSE}
m7.glmer <- update(m3.glmer, .~.+ Gradability)
car::vif(m7.glmer)
anova(m7.glmer, m3.glmer, test = "Chi")       
Anova(m7.glmer, type = "III", test = "Chi")   
```

SemanticCategory

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
m8.glmer <- update(m7.glmer, .~.+ SemanticCategory)
car::vif(m8.glmer)
anova(m8.glmer, m7.glmer, test = "Chi")   
Anova(m8.glmer, type = "III", test = "Chi")
```

Emotionality

```{r amphkpie_02_41, echo=T, eval = T, message=FALSE, warning=FALSE}
m9.glmer <- update(m8.glmer, .~.+ Emotionality)
car::vif(m9.glmer)
anova(m9.glmer, m8.glmer, test = "Chi")      
```

2-way interaction

Emotionality

```{r amphkpie_02_43, echo=T, eval = T, message=FALSE, warning=FALSE}
m10.glmer <- update(m8.glmer, .~.+ Age*Gender)
car::vif(m10.glmer)
anova(m10.glmer, m8.glmer, test = "Chi")      
```

Age*Function

```{r amphkpie_02_45, echo=T, eval = T, message=FALSE, warning=FALSE}
m11.glmer <- update(m8.glmer, .~.+ Age*Function)
car::vif(m11.glmer)
anova(m11.glmer, m8.glmer, test = "Chi")      
```

Age*Date

```{r amphkpie_02_47, echo=T, eval = T, message=FALSE, warning=FALSE}
m12.glmer <- update(m8.glmer, .~.+ Age*Date)
car::vif(m12.glmer)    
```

Age*Frequency

```{r amphkpie_02_49, echo=T, eval = T, message=FALSE, warning=FALSE}
m13.glmer <- update(m8.glmer, .~.+ Age*Frequency)
car::vif(m13.glmer)
anova(m13.glmer, m8.glmer, test = "Chi")      
```

Age*Priming

```{r amphkpie_02_51, echo=T, eval = T, message=FALSE, warning=FALSE}
m14.glmer <- update(m8.glmer, .~.+ Age*Priming)
car::vif(m14.glmer)
anova(m14.glmer, m8.glmer, test = "Chi")      
```

Age*Gradability

```{r amphkpie_02_53, echo=T, eval = T, message=FALSE, warning=FALSE}
m15.glmer <- update(m8.glmer, .~.+ Age*Gradability)
car::vif(m15.glmer)
anova(m15.glmer, m8.glmer, test = "Chi")      
```

Age*SemanticCategory

```{r amphkpie_02_55, echo=T, eval = T, message=FALSE, warning=FALSE}
m16.glmer <- update(m8.glmer, .~.+ Age*SemanticCategory)
car::vif(m16.glmer)   
```

Age*Emotionality

```{r amphkpie_02_57, echo=T, eval = T, message=FALSE, warning=FALSE}
m17.glmer <- update(m8.glmer, .~.+ Age*Emotionality)
car::vif(m17.glmer)    
```

Gender*Function

```{r amphkpie_02_59, echo=T, eval = T, message=FALSE, warning=FALSE}
m18.glmer <- update(m8.glmer, .~.+ Gender*Function)
car::vif(m18.glmer)
anova(m18.glmer, m8.glmer, test = "Chi")      
```

Gender*Date

```{r amphkpie_02_61, echo=T, eval = T, message=FALSE, warning=FALSE}
m19.glmer <- update(m8.glmer, .~.+ Gender*Date)
car::vif(m19.glmer)
anova(m19.glmer, m8.glmer, test = "Chi")      
```

Gender*Frequency

```{r amphkpie_02_63, echo=T, eval = T, message=FALSE, warning=FALSE}
m20.glmer <- update(m8.glmer, .~.+ Gender*Frequency)
car::vif(m20.glmer)
anova(m20.glmer, m8.glmer, test = "Chi")      
```

Gender*Priming

```{r amphkpie_02_65, echo=T, eval = T, message=FALSE, warning=FALSE}
m21.glmer <- update(m8.glmer, .~.+ Gender*Priming)
car::vif(m21.glmer)
anova(m21.glmer, m8.glmer, test = "Chi") 
Anova(m21.glmer, type = "III", test = "Chi")
```

Gender*Gradability

```{r amphkpie_02_67, echo=T, eval = T, message=FALSE, warning=FALSE}
m22.glmer <- update(m21.glmer, .~.+ Gender*Gradability)
car::vif(m22.glmer)
anova(m22.glmer, m21.glmer, test = "Chi")      
```

Gender*SemanticCategory

```{r amphkpie_02_69, echo=T, eval = T, message=FALSE, warning=FALSE}
m23.glmer <- update(m21.glmer, .~.+ Gender*SemanticCategory)
car::vif(m23.glmer)
```

Gender*Emotionality

```{r amphkpie_02_71, echo=T, eval = T, message=FALSE, warning=FALSE}
m24.glmer <- update(m21.glmer, .~.+ Gender*Emotionality)
car::vif(m24.glmer)
anova(m24.glmer, m21.glmer, test = "Chi")      
```

Function*Date

```{r amphkpie_02_73, echo=T, eval = T, message=FALSE, warning=FALSE}
m25.glmer <- update(m21.glmer, .~.+ Function*Date)
car::vif(m25.glmer)
anova(m25.glmer, m21.glmer, test = "Chi")      
```

Function*Frequency

```{r amphkpie_02_75, echo=T, eval = T, message=FALSE, warning=FALSE}
m26.glmer <- update(m21.glmer, .~.+ Function*Frequency)
car::vif(m26.glmer)
anova(m26.glmer, m21.glmer, test = "Chi")      
```

Function*Priming

```{r amphkpie_02_77, echo=T, eval = T, message=FALSE, warning=FALSE}
m27.glmer <- update(m21.glmer, .~.+ Function*Priming)
car::vif(m27.glmer)
anova(m27.glmer, m21.glmer, test = "Chi")      
```

Function*Gradability

```{r amphkpie_02_79, echo=T, eval = T, message=FALSE, warning=FALSE}
m28.glmer <- update(m21.glmer, .~.+ Function*Gradability)
car::vif(m28.glmer)
anova(m28.glmer, m21.glmer, test = "Chi")      
```

Function*SemanticCategory

```{r amphkpie_02_81, echo=T, eval = T, message=FALSE, warning=FALSE}
m29.glmer <- update(m21.glmer, .~.+ Function*SemanticCategory)
car::vif(m29.glmer)
```

Function*Emotionality

```{r amphkpie_02_83, echo=T, eval = T, message=FALSE, warning=FALSE}
m30.glmer <- update(m21.glmer, .~.+ Function*Emotionality)
car::vif(m30.glmer)      
```

Date*Frequency

```{r amphkpie_02_85, echo=T, eval = T, message=FALSE, warning=FALSE}
m31.glmer <- update(m21.glmer, .~.+ Date*Frequency)
car::vif(m31.glmer)
anova(m31.glmer, m21.glmer, test = "Chi")      
```

Date*Priming

```{r amphkpie_02_87, echo=T, eval = T, message=FALSE, warning=FALSE}
m32.glmer <- update(m21.glmer, .~.+ Date*Priming)
car::vif(m32.glmer)
anova(m32.glmer, m21.glmer, test = "Chi")      
```

Date*Gradability

```{r amphkpie_02_89, echo=T, eval = T, message=FALSE, warning=FALSE}
m33.glmer <- update(m21.glmer, .~.+ Date*Gradability)
car::vif(m33.glmer)
anova(m33.glmer, m21.glmer, test = "Chi")      
```

Date*SemanticCategory

```{r amphkpie_02_91, echo=T, eval = T, message=FALSE, warning=FALSE}
m34.glmer <- update(m21.glmer, .~.+ Date*SemanticCategory)
car::vif(m34.glmer)  
```

Date*Emotionality

```{r amphkpie_02_93, echo=T, eval = T, message=FALSE, warning=FALSE}
m35.glmer <- update(m21.glmer, .~.+ Date*Emotionality)
car::vif(m35.glmer)
```

Frequency*Priming

```{r amphkpie_02_95, echo=T, eval = T, message=FALSE, warning=FALSE}
m36.glmer <- update(m21.glmer, .~.+ Frequency*Priming)
car::vif(m36.glmer)
anova(m36.glmer, m21.glmer, test = "Chi") 
```

Frequency*Gradability

```{r amphkpie_02_97, echo=T, eval = T, message=FALSE, warning=FALSE}
m37.glmer <- update(m21.glmer, .~.+ Frequency*Gradability)
car::vif(m37.glmer)
anova(m37.glmer, m21.glmer, test = "Chi") 
```

Frequency*SemanticCategory

```{r amphkpie_02_99, echo=T, eval = T, message=FALSE, warning=FALSE}
m38.glmer <- update(m21.glmer, .~.+ Frequency*SemanticCategory)
car::vif(m38.glmer)
```

Frequency*Emotionality

```{r amphkpie_02_101, echo=T, eval = T, message=FALSE, warning=FALSE}
m39.glmer <- update(m21.glmer, .~.+ Frequency*Emotionality)
car::vif(m39.glmer)     
```

Priming*Gradability

```{r amphkpie_02_103, echo=T, eval = T, message=FALSE, warning=FALSE}
m40.glmer <- update(m21.glmer, .~.+ Priming*Gradability)
car::vif(m40.glmer)
anova(m40.glmer, m21.glmer, test = "Chi")      
```

Priming*SemanticCategory

```{r amphkpie_02_105, echo=T, eval = T, message=FALSE, warning=FALSE}
m41.glmer <- update(m21.glmer, .~.+ Priming*SemanticCategory)
car::vif(m41.glmer)     
```

Priming*Emotionality

```{r amphkpie_02_107, echo=T, eval = T, message=FALSE, warning=FALSE}
m42.glmer <- update(m21.glmer, .~.+ Priming*Emotionality)
car::vif(m42.glmer)
anova(m42.glmer, m21.glmer, test = "Chi")      
```

Gradability*SemanticCategory

```{r amphkpie_02_109, echo=T, eval = T, message=FALSE, warning=FALSE}
m43.glmer <- update(m21.glmer, .~.+ Gradability*SemanticCategory)
car::vif(m43.glmer)     
```

Gradability*Emotionality

```{r amphkpie_02_111, echo=T, eval = T, message=FALSE, warning=FALSE}
m44.glmer <- update(m21.glmer, .~.+ Gradability*Emotionality)
car::vif(m44.glmer)
anova(m44.glmer, m21.glmer, test = "Chi")      
```

SemanticCategory*Emotionality

```{r amphkpie_02_113, echo=T, eval = T, message=FALSE, warning=FALSE}
m45.glmer <- update(m21.glmer, .~.+ SemanticCategory*Emotionality)
car::vif(m45.glmer)      
```

Extract predictors

```{r amphkpie_02_115, echo=T, eval = T, message=FALSE, warning=FALSE}
# find all 2-way interactions
library(utils)
#colnames(pphi)
# define variables included in interactions
vars <- c("Age" , "Gender", "Function", "Date", "Frequency", "Priming", 
          "Gradability", "SemanticCategory", "Emotionality")
# 3-way interactions (involving Variant)
intac_3way <- t(combn(vars, 3))
int3w <- paste(intac_3way[,1], intac_3way[,2], intac_3way[,3], sep = "*")
int3w
```

Check which 3-way interactions can be included

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
check_models <- function(int3w) {
  rslt <- sapply(int3w, function(x){
  frml <- formula(paste0("Variant ~  (1|Adjective) + (1|Speaker) +  Age + Gender + Function + Gradability + SemanticCategory + Priming + Gender:Priming + ", x))
  modl <- glmer(frml, data = phi_very, family = "binomial", control=glmerControl(optimizer="bobyqa"))
  report <- if(max(as.vector(unlist(car::vif(modl)[,1]))) <= 10){
    print(anova(modl, m21.glmer, test = "Chi"))
  } else {cat("Vifs too high!\n")}
  return(report)
})
  return(rslt)
}
# inspect
possible_models <- check_models(int3w)
```

All 3-way interactions too high

Compare final minimal adequate model to intercept-only base-line model

```{r amphkpie_02_47, echo=T, eval = T, message=FALSE, warning=FALSE}
mf.glmer <- m21.glmer
mf.very <- m21.glmer
# compare models                
anova(mf.glmer, m0.glmer, test = "Chi")
Anova(mf.glmer, type = "III", test = "Chi")
```

### Tabulate regression results{-}

```{r amphkpie_02_49, echo=T, eval = T, message=FALSE, warning=FALSE}
library(sjPlot)
tab_model(mf.glmer)
```

Extract effects

```{r amphkpie_02_49, echo=T, eval = T, message=FALSE, warning=FALSE}
library(ggeffects)
effectsdf <- ggeffect(mf.glmer)
# inspect effects
effectsdf
```

### Visualize effects{-}

Plot effects
 
```{r amphkpie_02_51, echo=T, eval = T, message=FALSE, warning=FALSE}
library(effects)
png("D:\\Uni\\Projekte\\02-Intensification\\AmpHKPIE\\images/effectsfinalmodel_phi_very.png",  width = 960, height = 480) 
plot(allEffects(mf.glmer), type="response", ylim=c(0,1), grid=TRUE, 
     lines = list(col="black", lty = 1, confint=list(style="bars", col = "grey80")), ylab = "Probability")
dev.off()
plot(allEffects(mf.glmer), type="response", ylim=c(0,1), grid=TRUE, 
     lines = list(col="black", lty = 1, confint=list(style="bars", col = "grey80")), ylab = "Probability")
```

### Visualize individual effects{-}

Custom plot

```{r amphkpie_02_52, echo=T, eval = T, message=FALSE, warning=FALSE}
library(gridExtra)
p1 <- plot_model(mf.glmer, type = "pred", terms = c("Age"))
p2 <- plot_model(mf.glmer, type = "pred", terms = c("Function"))
p3 <- plot_model(mf.glmer, type = "pred", terms = c("Gradability"))
p4 <- plot_model(mf.glmer, type = "pred", terms = c("SemanticCategory"))
p5 <- plot_model(mf.glmer, type = "pred", terms = c("Gender", "Priming"))
grid.arrange(grobs = list(p1, p2, p3, p4, p5), widths = c(1, 1), layout_matrix = rbind(c(1, 2), c(3, 4), c(5, 5)))
```

Publishable plots

Age

```{r amphkpie_02_53, echo=T, eval = T, message=FALSE, warning=FALSE}
phi_very$Probability <- predict(mf.glmer, phi_very, type = "response")
ggplot(phi_very, aes(Age, Probability)) +
  stat_summary(fun.y = mean, geom = "point", size = 1.5, color = "gray20") +
  stat_summary(fun.data = mean_cl_boot, geom = "errorbar", 
               width = 0.2, size = .5, color = "gray20") +
  coord_cartesian(ylim = c(-.1, 1)) +
  theme_set(theme_bw(base_size = 12)) +
  theme(legend.position="top",
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(), 
        axis.text.x = element_text(size=10)) +
  labs(x = "Age", y = "Predicted probability") +
    scale_x_discrete(limits = rev(levels(phi_very$Age))) +
  ggsave("D:\\Uni\\Projekte\\02-Intensification\\AmpHKPIE\\images/Pred_Age_phi_very.png",
       height = 5,  width = 6, dpi = 320)
```

```{r amphkpie_02_53, echo=T, eval = T, message=FALSE, warning=FALSE}
ggplot(phi_very, aes(Function, Probability)) +
  stat_summary(fun.y = mean, geom = "point", size = 1.5, color = "gray20") +
  stat_summary(fun.data = mean_cl_boot, geom = "errorbar", 
               width = 0.2, size = .5, color = "gray20") +
  coord_cartesian(ylim = c(-.1, 1)) +
  theme_set(theme_bw(base_size = 12)) +
  theme(legend.position="top",
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(), 
        axis.text.x = element_text(size=10)) +
  labs(x = "Function", y = "Predicted probability") +
  ggsave("D:\\Uni\\Projekte\\02-Intensification\\AmpHKPIE\\images/Pred_Function_phi_very.png",
       height = 5,  width = 6, dpi = 320)
```



```{r amphkpie_02_53, echo=T, eval = T, message=FALSE, warning=FALSE}
ggplot(phi_very, aes(Gradability, Probability)) +
  geom_smooth(se = T, method = "lm", color = "gray20") +
  coord_cartesian(ylim = c(-.1, 1)) +
  theme_set(theme_bw(base_size = 12)) +
  theme(legend.position="top",
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(), 
        axis.text.x = element_text(size=10)) +
  labs(x = "Gradability", y = "Predicted probability") +
  ggsave("D:\\Uni\\Projekte\\02-Intensification\\AmpHKPIE\\images/Pred_Gradability_phi_very.png",
       height = 5,  width = 6, dpi = 320)
```

```{r amphkpie_02_53, echo=T, eval = T, message=FALSE, warning=FALSE}
ggplot(phi_very, aes(reorder(SemanticCategory, -Probability), Probability)) +
  stat_summary(fun.y = mean, geom = "point", size = 1.5, color = "gray20") +
  stat_summary(fun.data = mean_cl_boot, geom = "errorbar", 
               width = 0.2, size = .5, color = "gray20") +
  coord_cartesian(ylim = c(-.1, 1)) +
  theme_set(theme_bw(base_size = 12)) +
  theme(legend.position="top",
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(), 
        axis.text.x = element_text(size=10, angle = 90)) +
  labs(x = "SemanticCategory", y = "Predicted probability") +
  ggsave("D:\\Uni\\Projekte\\02-Intensification\\AmpHKPIE\\images/Pred_SemanticCategory_phi_very.png",
       height = 5,  width = 6, dpi = 320)
```

```{r amphkpie_02_53, echo=T, eval = T, message=FALSE, warning=FALSE}
ggplot(phi_very, aes(Gender, Probability, group = Priming, color = Priming)) +
  stat_summary(fun.y = mean, geom = "point", size = 1.5) +
  stat_summary(fun.data = mean_cl_boot, geom = "errorbar", 
               width = 0.2, size = .5) +
  coord_cartesian(ylim = c(-.1, 1)) +
  theme_set(theme_bw(base_size = 12)) +
  theme(legend.position="top",
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(), 
        axis.text.x = element_text(size=10, angle = 90)) +
  labs(x = "Gender", y = "Predicted probability") +
  scale_color_manual(breaks = c("NotPrimed", "Primed"),
                     values = c("gray30", "gray70"))
  ggsave("D:\\Uni\\Projekte\\02-Intensification\\AmpHKPIE\\images/Pred_SemanticCategory_phi_very.png",
       height = 5,  width = 6, dpi = 320)
```

### Visualize random effects

```{r amphkpie_02_79, echo=T, eval = T, message=FALSE, warning=FALSE}
randomtb <- ranef(mf.glmer)$Adjective
rndmlngtb <- data.frame(rownames(randomtb), randomtb)
colnames(rndmlngtb) <- c("Adjective", "Intercept")
rndmlngtb <- rndmlngtb[order(rndmlngtb$Intercept, decreasing = T),]
rndmlngtb
```

```{r amphkpie_02_81, echo=T, eval = T, message=FALSE, warning=FALSE}
summary(rndmlngtb$Intercept)
```

Publishable plot

```{r amphkpie_02_83, echo=T, eval = T, message=FALSE, warning=FALSE}
ggplot(rndmlngtb, aes(Adjective, Intercept)) +
  geom_point(aes(reorder(Adjective, -Intercept, fun = Intercept), y=Intercept)) +
  coord_cartesian(ylim = c(-1, 2)) +
  theme_set(theme_bw(base_size = 12)) +
  theme(legend.position="none",
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(), 
        axis.text.x = element_text(size=10, angle=90)) +
  labs(x = "Adjective type", y = "Adjustment to Intercept") +
  ggsave("D:\\Uni\\Projekte\\02-Intensification\\AmpHKPIE\\images/Pred_Adjectives_phi_very.png",
       height = 4,  width = 5, dpi = 320)
```


## REALLY

```{r amphkpie_02_17, echo=T, eval = T, message=FALSE, warning=FALSE}
phi_really <- ice %>%
  ungroup() %>%
  filter(Corpus == "ICE-PHI") %>%
  mutate(Age = factor(Age),
         Date = ifelse(Date == "1991"|Date == "1992", "Before1993", "After1998"),
         Date = factor(Date, levels = c("Before1993", "After1998")),
         Corpus = factor(Corpus),
         Speaker = factor(Speaker),
         Variant = ifelse(Variant == "really", "really", "other"),
         Variant = factor(Variant)) %>%
  droplevels()
# inspect
head(phi_really)
```

Find variables that cannot be tested

```{r amphkpie_02_19, echo=T, eval = T, message=FALSE, warning=FALSE}
l <- sapply(phi_really, function(x) is.factor(x))
m <- phi_really[, l]
ifelse(n <- sapply(m, function(x) length(levels(x))) == 1, "DROP", "NODROP")
```

Remove variables and NA

```{r amphkpie_02_21, echo=T, eval = T, message=FALSE, warning=FALSE}
nrow(phi_really)
phi_really <- phi_really %>%
  select(-Corpus, -EducationLevel, -Ethnicity) %>%
  na.omit()
nrow(phi_really)
```

## Regression analysis{-}

Prepare data

```{r amphkpie_02_37, echo=T, eval = T, message=FALSE, warning=FALSE}
library(rms)
library(lme4)
# set options
options(contrasts  =c("contr.treatment", "contr.poly"))
phi_really.dist <- datadist(phi_really)
options(datadist = "phi_really.dist")
# generate models
m0.glmer = glmer(Variant ~ 1 + (1|Adjective) + (1|Speaker), 
                 data = phi_really, family = "binomial",
                 control=glmerControl(optimizer="bobyqa"))
# extract aics
aic.m0.glmer <- AIC(logLik(m0.glmer))
aic.m0.glmer
```

### Model fitting{-}

Age

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
m1.glmer <- update(m0.glmer, .~.+Age)
anova(m1.glmer, m0.glmer, test = "Chi")       
library(car)
Anova(m1.glmer, type = "III", test = "Chi")   
```

Gender

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
m2.glmer <- update(m1.glmer, .~.+ Gender)
car::vif(m2.glmer)
anova(m2.glmer, m1.glmer, test = "Chi")       
Anova(m2.glmer, type = "III", test = "Chi")   
```

Function

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
m3.glmer <- update(m1.glmer, .~.+Function)
car::vif(m3.glmer)
anova(m3.glmer, m1.glmer, test = "Chi")       
Anova(m3.glmer, type = "III", test = "Chi")   
```

Date

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
m4.glmer <- update(m1.glmer, .~.+ Date)
car::vif(m4.glmer)
anova(m4.glmer, m1.glmer, test = "Chi")
```

Frequency

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
m5.glmer <- update(m1.glmer, .~.+ Frequency)
car::vif(m5.glmer)
anova(m5.glmer, m1.glmer, test = "Chi")   
```

Priming

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
m6.glmer <- update(m1.glmer, .~.+ Priming)
car::vif(m6.glmer)
anova(m6.glmer, m1.glmer, test = "Chi")
Anova(m6.glmer, type = "III", test = "Chi")
```

Gradability

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
m7.glmer <- update(m1.glmer, .~.+ Gradability)
car::vif(m7.glmer)
anova(m7.glmer, m1.glmer, test = "Chi")       
```

SemanticCategory

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
m8.glmer <- update(m1.glmer, .~.+ SemanticCategory)
car::vif(m8.glmer)
anova(m8.glmer, m1.glmer, test = "Chi")   
```

Emotionality

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
m9.glmer <- update(m1.glmer, .~.+ Emotionality)
car::vif(m9.glmer)
anova(m9.glmer, m1.glmer, test = "Chi")      
```

2-way interaction

Emotionality

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
m10.glmer <- update(m1.glmer, .~.+ Age*Gender)
car::vif(m10.glmer)
anova(m10.glmer, m1.glmer, test = "Chi")      
```

Age*Function

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
m11.glmer <- update(m1.glmer, .~.+ Age*Function)
car::vif(m11.glmer)
anova(m11.glmer, m1.glmer, test = "Chi") 
Anova(m11.glmer, type = "III", test = "Chi")
```

Age*Date

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
m12.glmer <- update(m1.glmer, .~.+ Age*Date)
car::vif(m12.glmer)    
```

Age*Frequency

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
m13.glmer <- update(m1.glmer, .~.+ Age*Frequency)
car::vif(m13.glmer)
anova(m13.glmer, m1.glmer, test = "Chi")      
```

Age*Priming

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
m14.glmer <- update(m1.glmer, .~.+ Age*Priming)
car::vif(m14.glmer)
anova(m14.glmer, m1.glmer, test = "Chi")      
```

Age*Gradability

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
m15.glmer <- update(m1.glmer, .~.+ Age*Gradability)
car::vif(m15.glmer)
anova(m15.glmer, m1.glmer, test = "Chi")      
```

Age*SemanticCategory

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
m16.glmer <- update(m1.glmer, .~.+ Age*SemanticCategory)
car::vif(m16.glmer)   
```

Age*Emotionality

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
m17.glmer <- update(m1.glmer, .~.+ Age*Emotionality)
car::vif(m17.glmer)    
```

Gender*Function

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
m18.glmer <- update(m1.glmer, .~.+ Gender*Function)
car::vif(m18.glmer)
anova(m18.glmer, m1.glmer, test = "Chi")      
```

Gender*Date

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
m19.glmer <- update(m1.glmer, .~.+ Gender*Date)
car::vif(m19.glmer)
```

Gender*Frequency

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
m20.glmer <- update(m1.glmer, .~.+ Gender*Frequency)
car::vif(m20.glmer)
anova(m20.glmer, m1.glmer, test = "Chi") 
Anova(m20.glmer, type = "III", test = "Chi")
```

Gender*Priming

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
m21.glmer <- update(m1.glmer, .~.+ Gender*Priming)
car::vif(m21.glmer)
anova(m21.glmer, m1.glmer, test = "Chi") 
Anova(m21.glmer, type = "III", test = "Chi")
```

Gender*Gradability

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
m22.glmer <- update(m1.glmer, .~.+ Gender*Gradability)
car::vif(m22.glmer)
anova(m22.glmer, m1.glmer, test = "Chi") 
```

Gender*SemanticCategory

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
m23.glmer <- update(m1.glmer, .~.+ Gender*SemanticCategory)
car::vif(m23.glmer)
anova(m23.glmer, m1.glmer, test = "Chi")
Anova(m23.glmer, type = "III", test = "Chi")
```

**WARNING**

Model m23.glmer cannot be used: *variance-covariance matrix computed from finite-difference Hessian is not positive definite or contains NA values: falling back to var-cov estimated from RX*

Gender*Emotionality

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
m24.glmer <- update(m1.glmer, .~.+ Gender*Emotionality)
car::vif(m24.glmer)     
anova(m24.glmer, m1.glmer, test = "Chi")
```

Function*Date

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
m25.glmer <- update(m1.glmer, .~.+ Function*Date)
car::vif(m25.glmer)     
anova(m25.glmer, m1.glmer, test = "Chi")
Anova(m25.glmer, type = "III", test = "Chi")
```

Function*Frequency

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
m26.glmer <- update(m25.glmer, .~.+ Function*Frequency)
car::vif(m26.glmer)      
```

Function*Priming

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
m27.glmer <- update(m25.glmer, .~.+ Function*Priming)
car::vif(m27.glmer)      
```

Function*Gradability

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
m28.glmer <- update(m25.glmer, .~.+ Function*Gradability)
car::vif(m28.glmer)      
```

Function*SemanticCategory

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
m29.glmer <- update(m25.glmer, .~.+ Function*SemanticCategory)
car::vif(m29.glmer)
```

Function*Emotionality

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
m30.glmer <- update(m25.glmer, .~.+ Function*Emotionality)
car::vif(m30.glmer)      
```

Date*Frequency

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
m31.glmer <- update(m25.glmer, .~.+ Date*Frequency)
car::vif(m31.glmer)      
```

Date*Priming

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
m32.glmer <- update(m25.glmer, .~.+ Date*Priming)
car::vif(m32.glmer)     
```

Date*Gradability

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
m33.glmer <- update(m25.glmer, .~.+ Date*Gradability)
car::vif(m33.glmer)      
```

Date*SemanticCategory

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
m34.glmer <- update(m25.glmer, .~.+ Date*SemanticCategory)
car::vif(m34.glmer)  
```

Date*Emotionality

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
m35.glmer <- update(m25.glmer, .~.+ Date*Emotionality)
car::vif(m35.glmer)
```

Frequency*Priming

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
m36.glmer <- update(m25.glmer, .~.+ Frequency*Priming)
car::vif(m36.glmer)
```

Frequency*Gradability

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
m37.glmer <- update(m25.glmer, .~.+ Frequency*Gradability)
car::vif(m37.glmer) 
```

Frequency*SemanticCategory

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
m38.glmer <- update(m25.glmer, .~.+ Frequency*SemanticCategory)
car::vif(m38.glmer)
```

Frequency*Emotionality

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
m39.glmer <- update(m25.glmer, .~.+ Frequency*Emotionality)
car::vif(m39.glmer)     
```

Priming*Gradability

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
m40.glmer <- update(m25.glmer, .~.+ Priming*Gradability)
car::vif(m40.glmer)   
```

Priming*SemanticCategory

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
m41.glmer <- update(m25.glmer, .~.+ Priming*SemanticCategory)
car::vif(m41.glmer)     
```

Priming*Emotionality

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
m42.glmer <- update(m25.glmer, .~.+ Priming*Emotionality)
car::vif(m42.glmer)      
```

Gradability*SemanticCategory

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
m43.glmer <- update(m25.glmer, .~.+ Gradability*SemanticCategory)
car::vif(m43.glmer)     
```

Gradability*Emotionality

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
m44.glmer <- update(m25.glmer, .~.+ Gradability*Emotionality)
car::vif(m44.glmer)     
```

SemanticCategory*Emotionality

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
m45.glmer <- update(m25.glmer, .~.+ SemanticCategory*Emotionality)
car::vif(m45.glmer)      
```

Extract predictors

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
# find all 2-way interactions
library(utils)
#colnames(pphi)
# define variables included in interactions
vars <- c("Age" , "Gender", "Function", "Date", "Frequency", "Priming", 
          "Gradability", "SemanticCategory", "Emotionality")
# 3-way interactions (involving Variant)
intac_3way <- t(combn(vars, 3))
int3w <- paste(intac_3way[,1], intac_3way[,2], intac_3way[,3], sep = "*")
int3w
```

Check which 3-way interactions can be included

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
check_models <- function(int3w) {
  rslt <- sapply(int3w, function(x){
  frml <- formula(paste0("Variant ~  (1|Adjective) + (1|Speaker) +  Age + Function + Date + Function:Date + ", x))
  modl <- glmer(frml, data = phi_really, family = "binomial", control=glmerControl(optimizer="bobyqa"))
  report <- if(max(as.vector(unlist(car::vif(modl)[,1]))) <= 10){
    print(anova(modl, m25.glmer, test = "Chi"))
  } else {cat("Vifs too high!\n")}
  return(report)
})
  return(rslt)
}
# inspect
possible_models <- check_models(int3w)
```

All 3-way interactions too high

Compare final minimal adequate model to intercept-only base-line model

```{r amphkpie_02_47, echo=T, eval = T, message=FALSE, warning=FALSE}
mf.glmer <- m25.glmer
mf.really <- m25.glmer
# compare models                
anova(mf.glmer, m0.glmer, test = "Chi")
Anova(mf.glmer, type = "III", test = "Chi")
```

### Tabulate regression results{-}

```{r amphkpie_02_49, echo=T, eval = T, message=FALSE, warning=FALSE}
library(sjPlot)
tab_model(mf.glmer)
```

Extract effects

```{r amphkpie_02_49, echo=T, eval = T, message=FALSE, warning=FALSE}
library(ggeffects)
effectsdf <- ggeffect(mf.glmer)
# inspect effects
effectsdf
```

### Visualize effects{-}

Plot effects
 
```{r amphkpie_02_51, echo=T, eval = T, message=FALSE, warning=FALSE}
library(effects)
png("D:\\Uni\\Projekte\\02-Intensification\\AmpHKPIE\\images/effectsfinalmodel_phi_really.png",  width = 960, height = 480) 
plot(allEffects(mf.glmer), type="response", ylim=c(0,1), grid=TRUE, 
     lines = list(col="black", lty = 1, confint=list(style="bars", col = "grey80")), ylab = "Probability")
dev.off()
plot(allEffects(mf.glmer), type="response", ylim=c(0,1), grid=TRUE, 
     lines = list(col="black", lty = 1, confint=list(style="bars", col = "grey80")), ylab = "Probability")
```

### Visualize individual effects{-}

Custom plot

```{r amphkpie_02_52, echo=T, eval = T, message=FALSE, warning=FALSE}
library(gridExtra)
p1 <- plot_model(mf.glmer, type = "pred", terms = c("Age"))
p2 <- plot_model(mf.glmer, type = "pred", terms = c("Function"))
p3 <- plot_model(mf.glmer, type = "pred", terms = c("Date"))
p4 <- plot_model(mf.glmer, type = "pred", terms = c("Function", "Date"))
grid.arrange(grobs = list(p1, p2, p3, p4), widths = c(1, 1), layout_matrix = rbind(c(1, 2), c(3, 4)))
```

Publishable plots

Age

```{r amphkpie_02_53, echo=T, eval = T, message=FALSE, warning=FALSE}
phi_really$Probability <- predict(mf.glmer, phi_really, type = "response")
ggplot(phi_really, aes(Age, Probability)) +
  stat_summary(fun.y = mean, geom = "point", size = 1.5, color = "gray20") +
  stat_summary(fun.data = mean_cl_boot, geom = "errorbar", 
               width = 0.2, size = .5, color = "gray20") +
  coord_cartesian(ylim = c(-.1, 1)) +
  theme_set(theme_bw(base_size = 12)) +
  theme(legend.position="top",
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(), 
        axis.text.x = element_text(size=10)) +
  labs(x = "Age", y = "Predicted probability") +
    scale_x_discrete(limits = rev(levels(phi_really$Age))) +
  ggsave("D:\\Uni\\Projekte\\02-Intensification\\AmpHKPIE\\images/Pred_Age_phi_really.png",
       height = 5,  width = 6, dpi = 320)
```

```{r amphkpie_02_53, echo=T, eval = T, message=FALSE, warning=FALSE}
ggplot(phi_really, aes(Date, Probability, group = Function, color = Function)) +
  stat_summary(fun.y = mean, geom = "point", size = 1.5) +
  stat_summary(fun.data = mean_cl_boot, geom = "errorbar", 
               width = 0.2, size = .5) +
  coord_cartesian(ylim = c(-.1, 1)) +
  theme_set(theme_bw(base_size = 12)) +
  theme(legend.position="top",
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(), 
        axis.text.x = element_text(size=10, angle = 90)) +
  labs(x = "Gender", y = "Predicted probability") +
  scale_color_manual(breaks = c("Attributive", "Predicative"),
                     values = c("gray30", "gray70"))
  ggsave("D:\\Uni\\Projekte\\02-Intensification\\AmpHKPIE\\images/Pred_DateFunction_phi_really.png",
       height = 5,  width = 6, dpi = 320)
```

### Visualize random effects

```{r amphkpie_02_79, echo=T, eval = T, message=FALSE, warning=FALSE}
randomtb <- ranef(mf.glmer)$Adjective
rndmlngtb <- data.frame(rownames(randomtb), randomtb)
colnames(rndmlngtb) <- c("Adjective", "Intercept")
rndmlngtb <- rndmlngtb[order(rndmlngtb$Intercept, decreasing = T),]
rndmlngtb
```

```{r amphkpie_02_81, echo=T, eval = T, message=FALSE, warning=FALSE}
summary(rndmlngtb$Intercept)
```

Publishable plot

```{r amphkpie_02_83, echo=T, eval = T, message=FALSE, warning=FALSE}
ggplot(rndmlngtb, aes(Adjective, Intercept)) +
  geom_point(aes(reorder(Adjective, -Intercept, fun = Intercept), y=Intercept)) +
  coord_cartesian(ylim = c(-1, 2)) +
  theme_set(theme_bw(base_size = 12)) +
  theme(legend.position="none",
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(), 
        axis.text.x = element_text(size=10, angle=90)) +
  labs(x = "Adjective type", y = "Adjustment to Intercept") +
  ggsave("D:\\Uni\\Projekte\\02-Intensification\\AmpHKPIE\\images/Pred_Adjectives_phi_really.png",
       height = 4,  width = 5, dpi = 320)
```

## SO

```{r amphkpie_02_17, echo=T, eval = T, message=FALSE, warning=FALSE}
phi_so <- ice %>%
  ungroup() %>%
  filter(Corpus == "ICE-PHI") %>%
  mutate(Age = factor(Age),
         Date = ifelse(Date == "1991"|Date == "1992", "Before1993", "After1998"),
         Date = factor(Date, levels = c("Before1993", "After1998")),
         Corpus = factor(Corpus),
         Speaker = factor(Speaker),
         Variant = ifelse(Variant == "so", "so", "other"),
         Variant = factor(Variant)) %>%
  droplevels()
# inspect
head(phi_so)
```

Find variables that cannot be tested

```{r amphkpie_02_19, echo=T, eval = T, message=FALSE, warning=FALSE}
l <- sapply(phi_so, function(x) is.factor(x))
m <- phi_so[, l]
ifelse(n <- sapply(m, function(x) length(levels(x))) == 1, "DROP", "NODROP")
```

Remove variables and NA

```{r amphkpie_02_21, echo=T, eval = T, message=FALSE, warning=FALSE}
nrow(phi_so)
phi_so <- phi_so %>%
  select(-Corpus, -EducationLevel, -Ethnicity) %>%
  na.omit()
nrow(phi_so)
```

## Regression analysis{-}

Prepare data

```{r amphkpie_02_37, echo=T, eval = T, message=FALSE, warning=FALSE}
library(rms)
library(lme4)
# set options
options(contrasts  =c("contr.treatment", "contr.poly"))
phi_so.dist <- datadist(phi_so)
options(datadist = "phi_so.dist")
# generate models
m0.glmer = glmer(Variant ~ 1 + (1|Adjective) + (1|Speaker), 
                 data = phi_so, family = "binomial",
                 control=glmerControl(optimizer="bobyqa"))
# extract aics
aic.m0.glmer <- AIC(logLik(m0.glmer))
aic.m0.glmer
```

### Model fitting{-}

Age

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
m1.glmer <- update(m0.glmer, .~.+Age)
anova(m1.glmer, m0.glmer, test = "Chi")       
library(car)
Anova(m1.glmer, type = "III", test = "Chi")   
```

Gender

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
m2.glmer <- update(m1.glmer, .~.+ Gender)
car::vif(m2.glmer)
anova(m2.glmer, m1.glmer, test = "Chi")       
Anova(m2.glmer, type = "III", test = "Chi")   
```

Function

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
m3.glmer <- update(m2.glmer, .~.+Function)
car::vif(m3.glmer)
anova(m3.glmer, m1.glmer, test = "Chi")       
Anova(m3.glmer, type = "III", test = "Chi")   
```

Date

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
m4.glmer <- update(m2.glmer, .~.+ Date)
car::vif(m4.glmer)
anova(m4.glmer, m2.glmer, test = "Chi")
Anova(m4.glmer, type = "III", test = "Chi")  
```

Frequency

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
m5.glmer <- update(m2.glmer, .~.+ Frequency)
car::vif(m5.glmer)
anova(m5.glmer, m2.glmer, test = "Chi")   
```

Priming

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
m6.glmer <- update(m2.glmer, .~.+ Priming)
car::vif(m6.glmer)
anova(m6.glmer, m2.glmer, test = "Chi")
Anova(m6.glmer, type = "III", test = "Chi")
```

Gradability

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
m7.glmer <- update(m6.glmer, .~.+ Gradability)
car::vif(m7.glmer)
anova(m7.glmer, m6.glmer, test = "Chi") 
Anova(m7.glmer, type = "III", test = "Chi")
```

SemanticCategory

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
m8.glmer <- update(m6.glmer, .~.+ SemanticCategory)
car::vif(m8.glmer)
anova(m8.glmer, m1.glmer, test = "Chi")  
Anova(m8.glmer, type = "III", test = "Chi")
```

Emotionality

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
m9.glmer <- update(m8.glmer, .~.+ Emotionality)
car::vif(m9.glmer)
anova(m9.glmer, m8.glmer, test = "Chi") 
Anova(m9.glmer, type = "III", test = "Chi")
```

2-way interaction

Age*Gender

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
m10.glmer <- update(m9.glmer, .~.+ Age*Gender)
car::vif(m10.glmer)
anova(m10.glmer, m9.glmer, test = "Chi")      
```

Age*Function

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
m11.glmer <- update(m9.glmer, .~.+ Age*Function)
car::vif(m11.glmer)
```

Age*Date

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
m12.glmer <- update(m9.glmer, .~.+ Age*Date)
car::vif(m12.glmer)    
```

Age*Frequency

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
m13.glmer <- update(m9.glmer, .~.+ Age*Frequency)
car::vif(m13.glmer)
anova(m13.glmer, m9.glmer, test = "Chi")      
```

Age*Priming

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
m14.glmer <- update(m9.glmer, .~.+ Age*Priming)
car::vif(m14.glmer)
anova(m14.glmer, m9.glmer, test = "Chi") 
Anova(m14.glmer, type = "III", test = "Chi")
```

Age*Gradability

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
m15.glmer <- update(m14.glmer, .~.+ Age*Gradability)
car::vif(m15.glmer)
anova(m15.glmer, m14.glmer, test = "Chi")      
```

Age*SemanticCategory

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
m16.glmer <- update(m14.glmer, .~.+ Age*SemanticCategory)
car::vif(m16.glmer)   
```

Age*Emotionality

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
m17.glmer <- update(m14.glmer, .~.+ Age*Emotionality)
car::vif(m17.glmer)    
```

Gender*Function

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
m18.glmer <- update(m14.glmer, .~.+ Gender*Function)
car::vif(m18.glmer)    
```

Gender*Date

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
m19.glmer <- update(m14.glmer, .~.+ Gender*Date)
car::vif(m19.glmer)
anova(m19.glmer, m14.glmer, test = "Chi")
Anova(m19.glmer, type = "III", test = "Chi")
```

Gender*Frequency

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
m20.glmer <- update(m19.glmer, .~.+ Gender*Frequency)
car::vif(m20.glmer)
anova(m20.glmer, m19.glmer, test = "Chi") 
```

Gender*Priming

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
m21.glmer <- update(m19.glmer, .~.+ Gender*Priming)
car::vif(m21.glmer)
anova(m21.glmer, m19.glmer, test = "Chi") 
Anova(m21.glmer, type = "III", test = "Chi")
```

Gender*Gradability

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
m22.glmer <- update(m19.glmer, .~.+ Gender*Gradability)
car::vif(m22.glmer)
anova(m22.glmer, m19.glmer, test = "Chi") 
```

Gender*SemanticCategory

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
m23.glmer <- update(m19.glmer, .~.+ Gender*SemanticCategory)
car::vif(m23.glmer)
anova(m23.glmer, m19.glmer, test = "Chi")
```

Gender*Emotionality

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
m24.glmer <- update(m19.glmer, .~.+ Gender*Emotionality)
car::vif(m24.glmer)     
anova(m24.glmer, m19.glmer, test = "Chi")
```

Function*Date

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
m25.glmer <- update(m19.glmer, .~.+ Function*Date)
car::vif(m25.glmer)     
```

Function*Frequency

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
m26.glmer <- update(m19.glmer, .~.+ Function*Frequency)
car::vif(m26.glmer)      
```

Function*Priming

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
m27.glmer <- update(m19.glmer, .~.+ Function*Priming)
car::vif(m27.glmer)      
```

Function*Gradability

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
m28.glmer <- update(m19.glmer, .~.+ Function*Gradability)
car::vif(m28.glmer)      
```

Function*SemanticCategory

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
m29.glmer <- update(m19.glmer, .~.+ Function*SemanticCategory)
car::vif(m29.glmer)
```

Function*Emotionality

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
m30.glmer <- update(m19.glmer, .~.+ Function*Emotionality)
car::vif(m30.glmer)      
```

Date*Frequency

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
m31.glmer <- update(m19.glmer, .~.+ Date*Frequency)
car::vif(m31.glmer)      
```

Date*Priming

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
m32.glmer <- update(m19.glmer, .~.+ Date*Priming)
car::vif(m32.glmer)     
```

Date*Gradability

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
m33.glmer <- update(m19.glmer, .~.+ Date*Gradability)
car::vif(m33.glmer)
anova(m33.glmer, m19.glmer, test = "Chi")
```

Date*SemanticCategory

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
m34.glmer <- update(m19.glmer, .~.+ Date*SemanticCategory)
car::vif(m34.glmer)  
```

Date*Emotionality

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
m35.glmer <- update(m19.glmer, .~.+ Date*Emotionality)
car::vif(m35.glmer)
```

Frequency*Priming

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
m36.glmer <- update(m19.glmer, .~.+ Frequency*Priming)
car::vif(m36.glmer)
anova(m36.glmer, m19.glmer, test = "Chi")
```

Frequency*Gradability

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
m37.glmer <- update(m19.glmer, .~.+ Frequency*Gradability)
car::vif(m37.glmer) 
anova(m37.glmer, m19.glmer, test = "Chi")
```

Frequency*SemanticCategory

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
m38.glmer <- update(m19.glmer, .~.+ Frequency*SemanticCategory)
car::vif(m38.glmer)
```

Frequency*Emotionality

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
m39.glmer <- update(m19.glmer, .~.+ Frequency*Emotionality)
car::vif(m39.glmer)     
```

Priming*Gradability

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
m40.glmer <- update(m19.glmer, .~.+ Priming*Gradability)
car::vif(m40.glmer)   
anova(m40.glmer, m19.glmer, test = "Chi")
```

Priming*SemanticCategory

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
m41.glmer <- update(m19.glmer, .~.+ Priming*SemanticCategory)
car::vif(m41.glmer) 
```

Priming*Emotionality

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
m42.glmer <- update(m19.glmer, .~.+ Priming*Emotionality)
car::vif(m42.glmer) 
anova(m42.glmer, m19.glmer, test = "Chi")
```

Gradability*SemanticCategory

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
m43.glmer <- update(m19.glmer, .~.+ Gradability*SemanticCategory)
car::vif(m43.glmer)     
```

Gradability*Emotionality

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
m44.glmer <- update(m19.glmer, .~.+ Gradability*Emotionality)
car::vif(m44.glmer)     
anova(m44.glmer, m19.glmer, test = "Chi")
```

SemanticCategory*Emotionality

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
m45.glmer <- update(m19.glmer, .~.+ SemanticCategory*Emotionality)
car::vif(m45.glmer)      
```

Extract predictors

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
# find all 2-way interactions
library(utils)
#colnames(pphi)
# define variables included in interactions
vars <- c("Age" , "Gender", "Function", "Date", "Frequency", "Priming", 
          "Gradability", "SemanticCategory", "Emotionality")
# 3-way interactions (involving Variant)
intac_3way <- t(combn(vars, 3))
int3w <- paste(intac_3way[,1], intac_3way[,2], intac_3way[,3], sep = "*")
int3w
```

Check which 3-way interactions can be included

```{r amphkpie_02_39, echo=T, eval = T, message=FALSE, warning=FALSE}
check_models <- function(int3w) {
  rslt <- sapply(int3w, function(x){
  frml <- formula(paste0("Variant ~  (1|Adjective) + (1|Speaker) +  Age + Gender + Priming + SemanticCategory + Emotionality + Date + Age:Priming + Gender:Date + ", x))
  modl <- glmer(frml, data = phi_so, family = "binomial", control=glmerControl(optimizer="bobyqa"))
  report <- if(max(as.vector(unlist(car::vif(modl)[,1]))) <= 10){
    print(anova(modl, m19.glmer, test = "Chi"))
  } else {cat("Vifs too high!\n")}
  return(report)
})
  return(rslt)
}
# inspect
possible_models <- check_models(int3w)
```

All 3-way interactions too high

Compare final minimal adequate model to intercept-only base-line model

```{r amphkpie_02_47, echo=T, eval = T, message=FALSE, warning=FALSE}
mf.glmer <- m19.glmer
mf.so <- m19.glmer
# compare models                
anova(mf.glmer, m0.glmer, test = "Chi")
Anova(mf.glmer, type = "III", test = "Chi")
```

### Tabulate regression results{-}

```{r amphkpie_02_49, echo=T, eval = T, message=FALSE, warning=FALSE}
library(sjPlot)
tab_model(mf.glmer)
```

Extract effects

```{r amphkpie_02_49, echo=T, eval = T, message=FALSE, warning=FALSE}
library(ggeffects)
effectsdf <- ggeffect(mf.glmer)
# inspect effects
effectsdf
```

### Visualize effects{-}

Plot effects
 
```{r amphkpie_02_51, echo=T, eval = T, message=FALSE, warning=FALSE}
library(effects)
png("D:\\Uni\\Projekte\\02-Intensification\\AmpHKPIE\\images/effectsfinalmodel_phi_so.png",  width = 960, height = 480) 
plot(allEffects(mf.glmer), type="response", ylim=c(0,1), grid=TRUE, 
     lines = list(col="black", lty = 1, confint=list(style="bars", col = "grey80")), ylab = "Probability")
dev.off()
plot(allEffects(mf.glmer), type="response", ylim=c(0,1), grid=TRUE, 
     lines = list(col="black", lty = 1, confint=list(style="bars", col = "grey80")), ylab = "Probability")
```

### Visualize individual effects{-}

Custom plot

```{r amphkpie_02_52, echo=T, eval = T, message=FALSE, warning=FALSE}
library(gridExtra)
p1 <- plot_model(mf.glmer, type = "pred", terms = c("SemanticCategory"))
p2 <- plot_model(mf.glmer, type = "pred", terms = c("Emotionality"))
p3 <- plot_model(mf.glmer, type = "pred", terms = c("Age", "Priming"))
p4 <- plot_model(mf.glmer, type = "pred", terms = c("Gender", "Priming"))
grid.arrange(grobs = list(p1, p2, p3, p4), widths = c(1, 1), layout_matrix = rbind(c(1, 2), c(3, 4)))
```

Publishable plots

Age

```{r amphkpie_02_53, echo=T, eval = T, message=FALSE, warning=FALSE}
phi_so$Probability <- predict(mf.glmer, phi_so, type = "response")
ggplot(phi_so, aes(x = reorder(SemanticCategory, - Probability), Probability)) +
  stat_summary(fun.y = mean, geom = "point", size = 1.5, color = "gray20") +
  stat_summary(fun.data = mean_cl_boot, geom = "errorbar", 
               width = 0.2, size = .5, color = "gray20") +
  coord_cartesian(ylim = c(-.1, 1)) +
  theme_set(theme_bw(base_size = 12)) +
  theme(legend.position="top",
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(), 
        axis.text.x = element_text(size=10, angle = 90)) +
  labs(x = "SemanticCategory", y = "Predicted probability") +
  ggsave("D:\\Uni\\Projekte\\02-Intensification\\AmpHKPIE\\images/Pred_SemanticCategory_phi_so.png",
       height = 5,  width = 6, dpi = 320)
```

```{r amphkpie_02_53, echo=T, eval = T, message=FALSE, warning=FALSE}
ggplot(phi_so, aes(Emotionality, Probability)) +
  stat_summary(fun.y = mean, geom = "point", size = 1.5, color = "gray20") +
  stat_summary(fun.data = mean_cl_boot, geom = "errorbar", 
               width = 0.2, size = .5, color = "gray20") +
  coord_cartesian(ylim = c(-.1, 1)) +
  theme_set(theme_bw(base_size = 12)) +
  theme(legend.position="top",
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(), 
        axis.text.x = element_text(size=10)) +
  labs(x = "Emotionality", y = "Predicted probability") +
  ggsave("D:\\Uni\\Projekte\\02-Intensification\\AmpHKPIE\\images/Pred_Emotionality_phi_so.png",
       height = 5,  width = 6, dpi = 320)
```


```{r amphkpie_02_53, echo=T, eval = T, message=FALSE, warning=FALSE}
ggplot(phi_so, aes(Age, Probability, group = Priming, color = Priming)) +
  stat_summary(fun.y = mean, geom = "point", size = 1.5) +
  stat_summary(fun.data = mean_cl_boot, geom = "errorbar", 
               width = 0.2, size = .5) +
  coord_cartesian(ylim = c(-.1, 1)) +
  theme_set(theme_bw(base_size = 12)) +
  theme(legend.position="top",
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(), 
        axis.text.x = element_text(size=10)) +
  labs(x = "Age", y = "Predicted probability") +
    scale_color_manual(breaks = c("NotPrimed", "Primed"),
                     values = c("gray30", "gray70")) + 
  scale_x_discrete(limits = rev(levels(phi_very$Age))) +
  ggsave("D:\\Uni\\Projekte\\02-Intensification\\AmpHKPIE\\images/Pred_Age_Priming_phi_so.png",
       height = 5,  width = 6, dpi = 320)
```

```{r amphkpie_02_53, echo=T, eval = T, message=FALSE, warning=FALSE}
ggplot(phi_so, aes(Date, Probability, group = Gender, color = Gender)) +
  stat_summary(fun.y = mean, geom = "point", size = 1.5) +
  stat_summary(fun.data = mean_cl_boot, geom = "errorbar", 
               width = 0.2, size = .5) +
  coord_cartesian(ylim = c(-.1, 1)) +
  theme_set(theme_bw(base_size = 12)) +
  theme(legend.position="top",
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(), 
        axis.text.x = element_text(size=10)) +
  labs(x = "Date", y = "Predicted probability") +
  scale_color_manual(breaks = c("female", "male"),
                     values = c("gray30", "gray70")) + 
  ggsave("D:\\Uni\\Projekte\\02-Intensification\\AmpHKPIE\\images/Pred_Date_Gender_phi_so.png",
       height = 5,  width = 6, dpi = 320)
```


### Visualize random effects

```{r amphkpie_02_79, echo=T, eval = T, message=FALSE, warning=FALSE}
randomtb <- ranef(mf.glmer)$Adjective
rndmlngtb <- data.frame(rownames(randomtb), randomtb)
colnames(rndmlngtb) <- c("Adjective", "Intercept")
rndmlngtb <- rndmlngtb[order(rndmlngtb$Intercept, decreasing = T),]
rndmlngtb
```

```{r amphkpie_02_81, echo=T, eval = T, message=FALSE, warning=FALSE}
summary(rndmlngtb$Intercept)
```

Publishable plot

```{r amphkpie_02_83, echo=T, eval = T, message=FALSE, warning=FALSE}
ggplot(rndmlngtb, aes(Adjective, Intercept)) +
  geom_point(aes(reorder(Adjective, -Intercept, fun = Intercept), y=Intercept)) +
  coord_cartesian(ylim = c(-1, 2)) +
  theme_set(theme_bw(base_size = 12)) +
  theme(legend.position="none",
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(), 
        axis.text.x = element_text(size=10, angle=90)) +
  labs(x = "Adjective type", y = "Adjustment to Intercept") +
  ggsave("D:\\Uni\\Projekte\\02-Intensification\\AmpHKPIE\\images/Pred_Adjectives_phi_so.png",
       height = 4,  width = 5, dpi = 320)
```

## Power analysis{-}

```{r amphkpie_02_85, echo=T, eval = T, message=FALSE, warning=FALSE}
# load package
library(simr)
# rename model
gm1 <- mf.glmer
# set seed for replicability
#set.seed(2020011401)
# calculate power for Age
#powerSim(gm1, fixed("Age", "lr"), nsim=100)
```

Extract fixed effecst estimates

```{r amphkpie_02_87, echo=T, eval = T, message=FALSE, warning=FALSE}
estimatesfixedeffects <- fixef(mf.glmer)
exp(estimatesfixedeffects)
```

Change effect size of Variant[really] to make it "medium" (odds ratio = 3.47 or Cohen's d of .5, estimate = 1.245)

```{r amphkpie_02_89, echo=T, eval = T, message=FALSE, warning=FALSE}
fixef(gm1)["Age41+"] <- 0.519
estimatesfixedeffects <- fixef(gm1)
exp(estimatesfixedeffects)
```

Percent accuracy of the model to detect a medium effect with a likelihood higher than 80 percent.

```{r amphkpie_02_91, echo=T, eval = T, message=FALSE, warning=FALSE}
# set seed for replicability
set.seed(2020011405)
powerSim(gm1, fixed("Age41+", "z"), nsim=100)
```

Extract session information

```{r amphkpie_02_93, echo=T, eval = T, message=FALSE, warning=FALSE}
sessionInfo()
``` 

=========================THE END=========================